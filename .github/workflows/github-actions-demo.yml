name: Generate Doxygen Docs to Wiki

on: [push]

jobs:
  Generate-Documentation:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout main repo
      uses: actions/checkout@v5
      
    - name: Checkout wiki repo
      uses: actions/checkout@v5
      with:
        repository: ${{ github.repository }}.wiki
        path: ./wiki
        
    - name: Install Doxygen and Graphviz
      run: sudo apt-get install -y doxygen graphviz
      
    - name: Generate Doxygen HTML
      run: doxygen doxygen.conf
      
    - name: Prepare wiki directory
      run: |
        rm -rf wiki/*.html wiki/*.css wiki/*.js wiki/*.map wiki/*.md
        cp -r docs/html/* wiki/
        
    - name: Deploy to Wiki
      run: |
        cd wiki
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add .
        git commit -m "Auto-generated documentation from ${{ github.sha }}" || exit 0
        git push